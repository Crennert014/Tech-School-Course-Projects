package Chapter17.Ch17_03;
import java.io.*;
import java.util.*;

public class Ch17_03 {
 private static final String fileName = "Exercise17_03.dat";

    public static void main(String[] args) {
        writeRandomIntegersToFile(fileName, 100);
        readAndDisplayIntegersFromFile(fileName);
        calculateSum();
    }

    public static void writeRandomIntegersToFile(String fileName, int count) {
        Random random = new Random();
        try (DataOutputStream output = new DataOutputStream(
                new BufferedOutputStream(
                        new FileOutputStream(fileName, true)))) {
            for (int i = 0; i < count; i++) {
                output.writeInt(random.nextInt(1000));
                output.writeByte(' ');
            }
        } catch (IOException ex) {
            ex.printStackTrace();
        }
    }

    public static void readAndDisplayIntegersFromFile(String fileName) {
        System.out.println("Integers in the file:");
        try (DataInputStream input = new DataInputStream(
                new BufferedInputStream(
                        new FileInputStream(fileName)))) {
            while (input.available() > 0) {
                int value = input.readInt();
                if (input.available() > 0) input.readByte();
                System.out.print(value + " ");
            }
            System.out.println();
        } catch (IOException ex) {
            ex.printStackTrace();
        }
    }

    public static int sumOfAllIntegers(DataInputStream input) throws IOException {
        int sum = 0;
        while (input.available() > 0) {
            sum += input.readInt();
            if (input.available() > 0) input.readByte(); // Skip space
        }
        return sum;
    }

    public static void calculateSum() {
        System.out.println("Calculating sum of all integers in the file:");

        try (DataInputStream input = new DataInputStream(
                new BufferedInputStream(
                        new FileInputStream(fileName)))) {
            int sum = sumOfAllIntegers(input);
            System.out.println("The sum of all integers: " + sum);
        } catch (IOException ex) {
            ex.printStackTrace();
        }
    }
}
