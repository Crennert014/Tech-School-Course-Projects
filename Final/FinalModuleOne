import java.io.*;
import java.time.LocalDate;
import java.util.ArrayList;
import java.util.List;
import java.util.Scanner;

public class finalproject {
    public static void main(String[] args) {
        String[] eggTypes = {"white", "brown", "green", "peacock"};
        String filename = "eggdata.csv";

        ensureFileHasHeader(filename, eggTypes);

        Scanner input = new Scanner(System.in);
        LocalDate today = LocalDate.now();
        String dateString = today.toString();

        int[] eggCounts = new int[eggTypes.length];
        System.out.println("Enter today's egg counts for: ");
        for (int i = 0; i < eggTypes.length; i++) {
            System.out.print("Number of " + eggTypes[i] + " eggs: ");
            eggCounts[i] = getIntInput(input);
        }

        saveEggEntry(filename, dateString, eggCounts);
        System.out.println("Today's entry saved.\n");

        // Display the matrix of all collected eggs by day
        displayEggMatrix(filename, eggTypes);

        input.close();
    }

    // Writes header if file does not exist or is empty
    public static void ensureFileHasHeader(String filename, String[] eggTypes) {
        File file = new File(filename);
        boolean needsHeader = !file.exists() || file.length() == 0;
        if (needsHeader) {
            try (PrintWriter pw = new PrintWriter(new FileWriter(filename, false))) {
                pw.print("Date");
                for (String eggType : eggTypes) {
                    pw.print("," + eggType);
                }
                pw.println();
            } catch (IOException e) {
                System.err.println("Failed to create header: " + e.getMessage());
            }
        }
    }

    // Save a single entry to CSV (append)
    public static void saveEggEntry(String filename, String date, int[] eggCounts) {
        try (PrintWriter pw = new PrintWriter(new FileWriter(filename, true))) {
            StringBuilder sb = new StringBuilder();
            sb.append(date);
            for (int count : eggCounts) {
                sb.append(",").append(count);
            }
            pw.println(sb.toString());
        } catch (IOException e) {
            System.err.println("Error saving entry: " + e.getMessage());
        }
    }

    // Safely get integer input
    private static int getIntInput(Scanner scanner) {
        while (true) {
            String line = scanner.nextLine();
            try {
                int value = Integer.parseInt(line.trim());
                if (value < 0) throw new NumberFormatException();
                return value;
            } catch (NumberFormatException e) {
                System.out.print("Enter a non-negative integer: ");
            }
        }
    }

    // Display the matrix of all eggs collected
    public static void displayEggMatrix(String filename, String[] eggTypes) {
        List<String[]> dataRows = new ArrayList<>();
        try (BufferedReader br = new BufferedReader(new FileReader(filename))) {
            String header = br.readLine(); // skip header
            String line;
            while ((line = br.readLine()) != null) {
                String[] parts = line.split(",");
                if (parts.length == eggTypes.length + 1) {
                    dataRows.add(parts);
                }
            }
        } catch (IOException e) {
            System.err.println("Error reading file for display: " + e.getMessage());
            return;
        }

        // Print header
        System.out.printf("%-12s", "Date");
        for (String eggType : eggTypes) {
            System.out.printf("%-12s", eggType);
        }
        System.out.printf("%-12s%n", "Total");

        // Print each row
        for (String[] row : dataRows) {
            System.out.printf("%-12s", row[0]);
            int dayTotal = 0;
            for (int i = 1; i < row.length; i++) {
                int count = Integer.parseInt(row[i]);
                System.out.printf("%-12d", count);
                dayTotal += count;
            }
            System.out.printf("%-12d%n", dayTotal);
        }
    }
}
